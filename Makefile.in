# $Id: Makefile.in,v 1.18 2002/04/03 00:24:09 bill Exp $
CC = @CC@
RM = @RM@
MKDEP = ${CC} -MM

TCMLIBS = @LIBS@
INCLUDES = -I./include
CPPFLAGS = ${INCLUDES} @CPPFLAGS@

# Any other defines you need, add below.
DEFINES = -DDPATH=\"@prefix@\"

# -O for optimization.  Can't debug.  Use -g for debuggable code.
CFLAGS = -g -O2

# Debuggers CFLAGS
# CFLAGS = -g -O -Wunused -Wall -ggdb -Wshadow -Wmissing-declarations

###### CHANGES BELOW HERE ONLY IF YOU KNOW WHAT YOU'RE DOING ######

SUBDIRS = src modules tools

OBJECTS = ${SOURCES:.c=.o}

all: tcm

build: tcm

install:
	-@if [ ! -x bin/tcm ] ; then \
	make all ; \
	fi

	@echo Installing...
	-@if [ ! -x @prefix@ ] ; then \
	echo mkdir @prefix@ ; \
	mkdir @prefix@ ; \
	fi

	-@if [ ! -x @prefix@/bin ] ; then \
	echo mkdir @prefix@/bin ; \
	mkdir @prefix@/bin ; \
	fi

	-@if [ ! -x @prefix@/etc ] ; then \
	echo mkdir @prefix@/etc ; \
	mkdir @prefix@/etc ; \
	fi

	-@if [ ! -x @prefix@/modules ] ; then \
	echo mkdir @prefix@/modules ; \
	mkdir @prefix@/modules ; \
	fi

	-@if [ ! -x @prefix@/help ] ; then \
	echo mkdir @prefix@/help ; \
	mkdir @prefix@/help ; \
	fi

	-@if [ ! -x @prefix@/logs ] ; then \
	echo mkdir @prefix@/logs ; \
	mkdir @prefix@/logs ; \
	fi

	mv -f bin/tcm bin/mkpasswd @prefix@/bin/

        -@if [ ! -e @prefix@/etc/tcm.cf ] ; then \
	echo mv etc/tcm.cf @prefix@/etc/ ; \
        mv etc/tcm.cf @prefix@/etc/ ; \
        fi

	-@if [ ! -e @prefix@/etc/userlist.cf ] ; then \
	echo mv etc/userlist.cf @prefix@/etc/ ; \
	mv -f etc/userlist.cf @prefix@/etc/ ; \
	fi

	cp modules/*.so @prefix@/modules/
	cp help/help.* @prefix@/help/
	@echo Done

clean:
	@${RM} -f DEBUG etc/tcm.pid tcm.core ktrace.out core
	@for i in $(SUBDIRS); do \
		echo "Cleaning $$i";\
		cd $$i;\
		${MAKE} clean; cd ..;\
	done
	-@if [ -f include/setup.h ] ; then \
	echo "To really restart installation, make distclean" ; \
	fi

cleandata:
	${RM} -f DEBUG etc/tcm.pid

distclean:
	@for i in $(SUBDIRS); do \
		echo "Distcleaning $$i";\
 		cd $$i;\
		${MAKE} distclean; cd ..;\
	done
	${RM} -f Makefile config.status config.cache config.log include/setup.h etc/tcm.pid
	${RM} -f DEBUG bin/tcm bin/mkpasswd etc/*.pref logs/*log logs/clone_log_* logs/tcm.log*
	${RM} -f ktrace.out tcm.core core

.c.o:
	${CC} ${CPPFLAGS} ${CFLAGS} ${DEFINES} -c $<

tcm:
	-@if [ ! -f include/setup.h ] ; then \
		echo "Hmm...doesn't look like you've run configure..."; \
		echo "Doing so now."; \
		sh configure; \
	fi
	@for i in $(SUBDIRS); do \
		echo "Building $$i";\
		cd $$i;\
		${MAKE} build; cd ..;\
	done

lint:
	@for i in $(SUBDIRS); do \
		echo "Linting $$i";\
		cd $$i;\
		${MAKE} lint; cd ..;\
	done

depend:
	@for i in $(SUBDIRS); do \
		echo "Making Dependencies in $$i";\
		cd $$i;\
		${MAKE} depend; cd ..;\
	done

