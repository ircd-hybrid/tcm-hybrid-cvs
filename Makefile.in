# $Id: Makefile.in,v 1.17 2002/04/02 23:58:03 bill Exp $
CC = @CC@
RM = @RM@
MKDEP = ${CC} -MM

TCMLIBS = @LIBS@
INCLUDES = -I./include
CPPFLAGS = ${INCLUDES} @CPPFLAGS@

# Any other defines you need, add below.
DEFINES = -DDPATH=\"@prefix@\"

# -O for optimization.  Can't debug.  Use -g for debuggable code.
CFLAGS = -g -O2

# Debuggers CFLAGS
# CFLAGS = -g -O -Wunused -Wall -ggdb -Wshadow -Wmissing-declarations

###### CHANGES BELOW HERE ONLY IF YOU KNOW WHAT YOU'RE DOING ######

SUBDIRS = src modules tools

OBJECTS = ${SOURCES:.c=.o}

all: tcm

build: tcm

install:
	-@if [ ! -x bin/tcm ] ; then \
	make all ; \
	fi

	@echo Installing...
	-@if [ ! -x ${DPATH} ] ; then \
	echo mkdir ${DPATH} ; \
	mkdir ${DPATH} ; \
	fi

	-@if [ ! -x ${DPATH}/bin ] ; then \
	echo mkdir ${DPATH}/bin ; \
	mkdir ${DPATH}/bin ; \
	fi

	-@if [ ! -x ${DPATH}/etc ] ; then \
	echo mkdir ${DPATH}/etc ; \
	mkdir ${DPATH}/etc ; \
	fi

	-@if [ ! -x ${DPATH}/modules ] ; then \
	echo mkdir ${DPATH}/modules ; \
	mkdir ${DPATH}/modules ; \
	fi

	-@if [ ! -x ${DPATH}/help ] ; then \
	echo mkdir ${DPATH}/help ; \
	mkdir ${DPATH}/help ; \
	fi

	-@if [ ! -x ${DPATH}/logs ] ; then \
	echo mkdir ${DPATH}/logs ; \
	mkdir ${DPATH}/logs ; \
	fi

	-@if [ -e ${DPATH}/bin/mkpasswd ] ; then \
	echo mv bin/tcm ${DPATH}/bin ; \
	mv bin/tcm ${DPATH}/bin/ ; \
	fi

	-@if [ ! -e ${DPATH}/bin/mkpasswd ] ; then \
	echo mv bin/tcm bin/mkpasswd ${DPATH}/bin/ ; \
	mv bin/tcm bin/mkpasswd ${DPATH}/bin/ ; \
	fi

	-@if [ ! -e ${DPATH}/etc/tcm.cf ] ; then \
	echo mv etc/tcm.cf ${DPATH}/etc/ ; \
	mv -f etc/tcm.cf ${DPATH}/etc/ ; \
	fi

	-@if [ ! -e ${DPATH}/etc/userlist.cf ] ; then \
	echo mv etc/userlist.cf ${DPATH}/etc/ ; \
	mv -f etc/userlist.cf ${DPATH}/etc/ ; \
	fi

	cp modules/*.so ${DPATH}/modules/
	cp help/help.* ${DPATH}/help/
	@echo Done

clean:
	@${RM} -f DEBUG etc/tcm.pid tcm.core ktrace.out core
	@for i in $(SUBDIRS); do \
		echo "Cleaning $$i";\
		cd $$i;\
		${MAKE} clean; cd ..;\
	done
	-@if [ -f include/setup.h ] ; then \
	echo "To really restart installation, make distclean" ; \
	fi

cleandata:
	${RM} -f DEBUG etc/tcm.pid

distclean:
	@for i in $(SUBDIRS); do \
		echo "Distcleaning $$i";\
 		cd $$i;\
		${MAKE} distclean; cd ..;\
	done
	${RM} -f Makefile config.status config.cache config.log include/setup.h etc/tcm.pid
	${RM} -f DEBUG bin/tcm bin/mkpasswd etc/*.pref logs/*log logs/clone_log_* logs/tcm.log*
	${RM} -f ktrace.out tcm.core core

.c.o:
	${CC} ${CPPFLAGS} ${CFLAGS} ${DEFINES} -c $<

tcm:
	-@if [ ! -f include/setup.h ] ; then \
		echo "Hmm...doesn't look like you've run configure..."; \
		echo "Doing so now."; \
		sh configure; \
	fi
	@for i in $(SUBDIRS); do \
		echo "Building $$i";\
		cd $$i;\
		${MAKE} build; cd ..;\
	done

lint:
	@for i in $(SUBDIRS); do \
		echo "Linting $$i";\
		cd $$i;\
		${MAKE} lint; cd ..;\
	done

depend:
	@for i in $(SUBDIRS); do \
		echo "Making Dependencies in $$i";\
		cd $$i;\
		${MAKE} depend; cd ..;\
	done

